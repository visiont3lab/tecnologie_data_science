

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>PYSPARK &#8212; Tecnologie &amp; Software di Data Science</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Tecnologie & Software di Data Science</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../introduzione_generale.html">Introduzione</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Programming Tools</p>
</li>
  <li class="">
    <a href="../programming/google_colab.html">Google Colaboratory</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Introduzione a Python</p>
</li>
  <li class="">
    <a href="../python/introduzione_programmazione.html">Introduzione programmazione</a>
  </li>
  <li class="">
    <a href="../python/numpy.html">Numpy</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Data Visualization</p>
</li>
  <li class="">
    <a href="../visualization/pandas.html">Pandas</a>
  </li>
  <li class="">
    <a href="../visualization/matplotlib.html">Matplotlib</a>
  </li>
  <li class="">
    <a href="../visualization/seaborn.html">Seaborn</a>
  </li>
  <li class="">
    <a href="../visualization/analisi_covid19_spiegazione.html">Analisi Covid19 dataset usando Pandas, Matplotlib, Plotly, Dash : (Spiegazione)</a>
  </li>
  <li class="">
    <a href="../visualization/analisi_covid19_esercizio.html">Analisi Covid19 dataset usando Pandas, Matplotlib, Plotly, Dash : (Soluzione)</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Regressione</p>
</li>
  <li class="">
    <a href="../regression/tips_dataset.html">TIPS Dataset</a>
  </li>
  <li class="">
    <a href="../regression/boston_housing_dataset.html">Boston Housing Dataset</a>
  </li>
  <li class="">
    <a href="../regression/regressore_custom_data.html">Regressione Custom Data</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Classificazione</p>
</li>
  <li class="">
    <a href="../classification/iris_dataset.html">Iris Dataset</a>
  </li>
  <li class="">
    <a href="../classification/binary_classifier.html">Binary classifier 5 or not 5 ?</a>
  </li>
  <li class="">
    <a href="../classification/decision_tree.html">Decision Tree</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Unsupervised</p>
</li>
  <li class="">
    <a href="../unsupervised/clustering.html">Clustering</a>
  </li>
  <li class="">
    <a href="../unsupervised/pca.html">PCA</a>
  </li>
  <li class="">
    <a href="../unsupervised/pca_regressione.html">PCA: Regressione</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">PySpark</p>
</li>
  <li class="">
    <a href="template_pyspark.html">Template</a>
  </li>
  <li class="">
    <a href="pyspark_dataframe.html">Dataframe</a>
  </li>
  <li class="">
    <a href="pyspark_dataframe_sql.html">SQL e Dataframe</a>
  </li>
  <li class="">
    <a href="pyspark_amazon.html">Amazon Ratings Books</a>
  </li>
  <li class="">
    <a href="pyspark_apple_stock.html">Analisi del prezzo delle Azioni di Apple</a>
  </li>
  <li class="">
    <a href="pyspark_movies.html">Analisi recensioni film</a>
  </li>
  <li class="">
    <a href="pyspark_boston.html">Pyspark</a>
  </li>
  <li class="">
    <a href="pyspark_RDD.html">RDD: Resilient Distributed Dataset</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/docs/pyspark/logistic_regr_pyspark.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#breast-cancer-dataset" class="nav-link">Breast Cancer Dataset</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><a href="https://colab.research.google.com/github/visiont3lab/tecnologie_data_science/blob/master/book/docs/pyspark/logistic_regr_pyspark.ipynb
" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="section" id="pyspark">
<h1>PYSPARK<a class="headerlink" href="#pyspark" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">################ template to run PySpark on Colab #######################</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null
!wget -q https://www-us.apache.org/dist/spark/spark-2.4.5/spark-2.4.5-bin-hadoop2.7.tgz
!tar xf spark-2.4.5-bin-hadoop2.7.tgz
!pip install -q findspark
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;JAVA_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/usr/lib/jvm/java-8-openjdk-amd64&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SPARK_HOME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/content/spark-2.4.5-bin-hadoop2.7&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">findspark</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[*]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">spark1</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s1">&#39;basic&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="c1">#Test must give no error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span><span class="p">,</span> <span class="n">SparkContext</span>
<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s2">&quot;basic&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
<span class="c1">#sc = SparkContext(conf=conf)  ## for jupyter and Databricks</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>   <span class="c1">## for Colab</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">################ end template PySpark on Colab ##########################</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="breast-cancer-dataset">
<h2>Breast Cancer Dataset<a class="headerlink" href="#breast-cancer-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget https://frenzy86.s3.eu-west-2.amazonaws.com/fav/tecno/breast_cancer.csv

cancer_df = spark.read.csv(&quot;breast_cancer.csv&quot;,header=True)
cancer_df.columns
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>--2020-06-22 21:46:04--  https://frenzy86.s3.eu-west-2.amazonaws.com/fav/tecno/breast_cancer.csv
Resolving frenzy86.s3.eu-west-2.amazonaws.com (frenzy86.s3.eu-west-2.amazonaws.com)... 52.95.148.90
Connecting to frenzy86.s3.eu-west-2.amazonaws.com (frenzy86.s3.eu-west-2.amazonaws.com)|52.95.148.90|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 145599 (142K) [application/vnd.ms-excel]
Saving to: ‘breast_cancer.csv.2’

breast_cancer.csv.2 100%[===================&gt;] 142.19K   193KB/s    in 0.7s    

2020-06-22 21:46:06 (193 KB/s) - ‘breast_cancer.csv.2’ saved [145599/145599]

</pre></div>
</div>
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;mean radius&#39;,
 &#39;mean texture&#39;,
 &#39;mean perimeter&#39;,
 &#39;mean area&#39;,
 &#39;mean smoothness&#39;,
 &#39;mean compactness&#39;,
 &#39;mean concavity&#39;,
 &#39;mean concave points&#39;,
 &#39;mean symmetry&#39;,
 &#39;mean fractal dimension&#39;,
 &#39;radius error&#39;,
 &#39;texture error&#39;,
 &#39;perimeter error&#39;,
 &#39;area error&#39;,
 &#39;smoothness error&#39;,
 &#39;compactness error&#39;,
 &#39;concavity error&#39;,
 &#39;concave points error&#39;,
 &#39;symmetry error&#39;,
 &#39;fractal dimension error&#39;,
 &#39;worst radius&#39;,
 &#39;worst texture&#39;,
 &#39;worst perimeter&#39;,
 &#39;worst area&#39;,
 &#39;worst smoothness&#39;,
 &#39;worst compactness&#39;,
 &#39;worst concavity&#39;,
 &#39;worst concave points&#39;,
 &#39;worst symmetry&#39;,
 &#39;worst fractal dimension&#39;,
 &#39;malignant&#39;]
</pre></div>
</div>
</div>
</div>
<p>Il DataFrame ha 31 colonne:</p>
<ul class="simple">
<li><p>30 features: che rappresentano delle proprietà dell’immagine, come raggio, area e perimetro.</p></li>
<li><p>1 target: che è la colonna malignant, un valore di 1 indica un tumore maligno, al contrario un valore di 0 indica un tumore benigno.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>+-----------+------------+--------------+---------+-------------------+-------------------+-------------------+--------------------+-------------+----------------------+------------+------------------+------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+------------+-------------+---------------+----------+-------------------+-----------------+-------------------+--------------------+--------------+-----------------------+---------+
|mean radius|mean texture|mean perimeter|mean area|    mean smoothness|   mean compactness|     mean concavity| mean concave points|mean symmetry|mean fractal dimension|radius error|     texture error|   perimeter error|area error|    smoothness error|   compactness error|     concavity error|concave points error|      symmetry error|fractal dimension error|worst radius|worst texture|worst perimeter|worst area|   worst smoothness|worst compactness|    worst concavity|worst concave points|worst symmetry|worst fractal dimension|malignant|
+-----------+------------+--------------+---------+-------------------+-------------------+-------------------+--------------------+-------------+----------------------+------------+------------------+------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+------------+-------------+---------------+----------+-------------------+-----------------+-------------------+--------------------+--------------+-----------------------+---------+
|      20.57|       17.77|         132.9|   1326.0|            0.08474|            0.07864|             0.0869| 0.07017000000000001|       0.1812|  0.056670000000000005|      0.5435|            0.7339|             3.398|     74.08|            0.005225|0.013080000000000001|              0.0186|              0.0134|0.013890000000000001|               0.003532|       24.99|        23.41|          158.8|    1956.0|             0.1238|           0.1866|             0.2416| 0.18600000000000003|         0.275|                0.08902|        0|
|      19.69|       21.25|         130.0|   1203.0|             0.1096|             0.1599|             0.1974|              0.1279|       0.2069|  0.059989999999999995|      0.7456|            0.7869|             4.585|     94.03|             0.00615|0.040060000000000005|             0.03832|             0.02058|              0.0225|               0.004571|       23.57|        25.53|          152.5|    1709.0|             0.1444|           0.4245|             0.4504|               0.243|        0.3613|    0.08757999999999999|        0|
|      11.42|       20.38|         77.58|    386.1|             0.1425|             0.2839|             0.2414|              0.1052|       0.2597|               0.09744|      0.4956|             1.156|             3.445|     27.23|             0.00911|             0.07458|             0.05661|             0.01867|0.059629999999999996|               0.009208|       14.91|         26.5|          98.87|     567.7|             0.2098|           0.8663|             0.6869|              0.2575|        0.6638|    0.17300000000000001|        0|
|      20.29|       14.34|         135.1|   1297.0|             0.1003|             0.1328|              0.198|              0.1043|       0.1809|   0.05882999999999999|      0.7572|            0.7813|             5.438|     94.44|             0.01149|             0.02461| 0.05687999999999999|             0.01885|             0.01756|               0.005115|       22.54|        16.67|          152.2|    1575.0|             0.1374|            0.205|                0.4|              0.1625|        0.2364|                0.07678|        0|
|      12.45|        15.7|         82.57|    477.1|             0.1278|               0.17|             0.1578|             0.08089|       0.2087|   0.07612999999999999|      0.3345|            0.8902|             2.217|     27.19|0.007509999999999999|             0.03345|0.036719999999999996|             0.01137|             0.02165|               0.005082|       15.47|        23.75|          103.4|     741.6|             0.1791|           0.5249|             0.5355|              0.1741|        0.3985|                 0.1244|        0|
|      18.25|       19.98|         119.6|   1040.0|0.09462999999999999|              0.109|             0.1127| 0.07400000000000001|       0.1794|  0.057420000000000006|      0.4467|            0.7732|              3.18|     53.91|            0.004314|0.013819999999999999|             0.02254|             0.01039|             0.01369|               0.002179|       22.88|        27.66|          153.2|    1606.0|             0.1442|           0.2576|             0.3784|              0.1932|        0.3063|    0.08367999999999999|        0|
|      13.71|       20.83|          90.2|    577.9|             0.1189|             0.1645|0.09366000000000001|             0.05985|       0.2196|               0.07451|      0.5835|1.3769999999999998|3.8560000000000003|     50.96|            0.008805|0.030289999999999997|0.024880000000000003|0.014480000000000002|             0.01486|               0.005412|       17.06|        28.14|          110.6|     897.0|             0.1654|           0.3682|             0.2678|              0.1556|        0.3196|                 0.1151|        0|
|       13.0|       21.82|          87.5|    519.8|             0.1273|             0.1932|             0.1859|             0.09353|        0.235|               0.07389|      0.3063|             1.002|             2.406|     24.32|            0.005731|0.035019999999999996|             0.03553|             0.01226|             0.02143|               0.003749|       15.49|        30.73|          106.2|     739.3|             0.1703|           0.5401|              0.539| 0.20600000000000002|        0.4378|                 0.1072|        0|
|      12.46|       24.04|         83.97|    475.9|             0.1186|             0.2396|             0.2273| 0.08542999999999999|        0.203|   0.08242999999999999|      0.2976|             1.599|             2.039|     23.94|0.007148999999999999|             0.07217|             0.07743|             0.01432|             0.01789|                0.01008|       15.09|        40.68|          97.65|     711.4|             0.1853|            1.058|              1.105|               0.221|        0.4366|                 0.2075|        0|
|      16.02|       23.24|         102.7|    797.8|0.08206000000000001|            0.06669|            0.03299|             0.03323|       0.1528|   0.05697000000000001|      0.3795|             1.187|2.4659999999999997|     40.51|            0.004029|            0.009269|0.011009999999999999|            0.007591|              0.0146|               0.003042|       19.19|        33.88|          123.8|    1150.0|             0.1181|           0.1551|             0.1459|             0.09975|        0.2948|                0.08452|        0|
|      15.78|       17.89|         103.6|    781.0|             0.0971|             0.1292|            0.09954| 0.06606000000000001|       0.1842|  0.060820000000000006|      0.5058|            0.9849|3.5639999999999996|     54.16|            0.005771|             0.04061|             0.02791|0.012819999999999998|             0.02008|               0.004144|       20.42|        27.28|          136.5|    1299.0|             0.1396|           0.5609|             0.3965| 0.18100000000000002|        0.3792|                 0.1048|        0|
|      19.17|        24.8|         132.4|   1123.0|             0.0974|             0.2458|             0.2065|              0.1118|       0.2397|                 0.078|      0.9555|             3.568|             11.07|     116.2|            0.003139|             0.08297|              0.0889|              0.0409|             0.04484|                0.01284|       20.96|        29.94|          151.7|    1332.0|             0.1037|           0.3903|             0.3639|              0.1767|        0.3176|                 0.1023|        0|
|      15.85|       23.95|         103.7|    782.7|            0.08401|             0.1002|            0.09938|             0.05364|       0.1847|               0.05338|      0.4033|             1.078|             2.903|     36.58|            0.009769|             0.03126|             0.05051|             0.01992|0.029810000000000003|               0.003002|       16.84|        27.66|          112.0|     876.5|             0.1131|           0.1924|             0.2322|              0.1119|        0.2809|    0.06287000000000001|        0|
|      13.73|       22.61|          93.6|    578.3|             0.1131|             0.2293|             0.2128|             0.08025|       0.2069|               0.07682|      0.2121|             1.169|             2.061|     19.21|0.006429000000000001|             0.05936|             0.05501|0.016280000000000003|             0.01961|   0.008093000000000001|       15.03|        32.01|          108.8|     697.7|             0.1651|           0.7725|             0.6943|              0.2208|        0.3596|                 0.1431|        0|
|      14.54|       27.54|         96.73|    658.8|             0.1139|             0.1595|             0.1639|             0.07364|       0.2303|               0.07077|        0.37|             1.033|2.8789999999999996|     32.55|            0.005607|              0.0424|             0.04741|              0.0109|             0.01857|   0.005465999999999...|       17.46|        37.13|          124.1|     943.2|             0.1678|           0.6577|             0.7026|              0.1712|        0.4218|                 0.1341|        0|
|      14.68|       20.13|         94.74|    684.5|0.09867000000000001|0.07200000000000001|            0.07395|             0.05259|       0.1586|               0.05922|      0.4727|              1.24|             3.195|      45.4|            0.005718|             0.01162|             0.01998|0.011090000000000001|              0.0141|               0.002085|       19.07|        30.88|          123.4|    1138.0|             0.1464|           0.1871|             0.2914|              0.1609|        0.3029|                0.08216|        0|
|      16.13|       20.68|         108.1|    798.8|0.11699999999999999|             0.2022|             0.1722|              0.1028|       0.2164|               0.07356|      0.5692|             1.073|3.8539999999999996|     54.18|            0.007026|             0.02501|             0.03188|0.012969999999999999|0.016890000000000002|               0.004142|       20.96|        31.48|          136.8|    1315.0|             0.1789|           0.4233|             0.4784|              0.2073|        0.3706|                 0.1142|        0|
|      19.81|       22.15|         130.0|   1260.0|0.09831000000000001|             0.1027|             0.1479|             0.09498|       0.1582|               0.05395|      0.7582|1.0170000000000001|             5.865|     112.4|            0.006494|0.018930000000000002|             0.03391|             0.01521|             0.01356|               0.001997|       27.32|        30.88|          186.8|    2398.0|             0.1512|            0.315|             0.5372|              0.2388|        0.2768|                0.07615|        0|
|      13.54|       14.36|         87.46|    566.3|            0.09779|            0.08129|0.06663999999999999|0.047810000000000005|       0.1885|               0.05766|      0.2699|            0.7886|2.0580000000000003|     23.56|            0.008462|              0.0146|             0.02387|             0.01315|              0.0198|                 0.0023|       15.11|        19.26|           99.7|     711.2|0.14400000000000002|           0.1773|              0.239|              0.1288|        0.2977|                0.07259|        1|
|      13.08|       15.71|         85.63|    520.0|             0.1075|              0.127|            0.04568|              0.0311|       0.1967|               0.06811|      0.1852|            0.7477|             1.383|     14.67|            0.004097|             0.01898|0.016980000000000002|0.006490000000000001|             0.01678|               0.002425|        14.5|        20.49|          96.09|     630.5|             0.1312|           0.2776|0.18899999999999997| 0.07282999999999999|        0.3184|                0.08183|        1|
+-----------+------------+--------------+---------+-------------------+-------------------+-------------------+--------------------+-------------+----------------------+------------+------------------+------------------+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-----------------------+------------+-------------+---------------+----------+-------------------+-----------------+-------------------+--------------------+--------------+-----------------------+---------+
only showing top 20 rows

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>root
 |-- mean radius: string (nullable = true)
 |-- mean texture: string (nullable = true)
 |-- mean perimeter: string (nullable = true)
 |-- mean area: string (nullable = true)
 |-- mean smoothness: string (nullable = true)
 |-- mean compactness: string (nullable = true)
 |-- mean concavity: string (nullable = true)
 |-- mean concave points: string (nullable = true)
 |-- mean symmetry: string (nullable = true)
 |-- mean fractal dimension: string (nullable = true)
 |-- radius error: string (nullable = true)
 |-- texture error: string (nullable = true)
 |-- perimeter error: string (nullable = true)
 |-- area error: string (nullable = true)
 |-- smoothness error: string (nullable = true)
 |-- compactness error: string (nullable = true)
 |-- concavity error: string (nullable = true)
 |-- concave points error: string (nullable = true)
 |-- symmetry error: string (nullable = true)
 |-- fractal dimension error: string (nullable = true)
 |-- worst radius: string (nullable = true)
 |-- worst texture: string (nullable = true)
 |-- worst perimeter: string (nullable = true)
 |-- worst area: string (nullable = true)
 |-- worst smoothness: string (nullable = true)
 |-- worst compactness: string (nullable = true)
 |-- worst concavity: string (nullable = true)
 |-- worst concave points: string (nullable = true)
 |-- worst symmetry: string (nullable = true)
 |-- worst fractal dimension: string (nullable = true)
 |-- malignant: string (nullable = true)

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;mean radius&#39;,
 &#39;mean texture&#39;,
 &#39;mean perimeter&#39;,
 &#39;mean area&#39;,
 &#39;mean smoothness&#39;,
 &#39;mean compactness&#39;,
 &#39;mean concavity&#39;,
 &#39;mean concave points&#39;,
 &#39;mean symmetry&#39;,
 &#39;mean fractal dimension&#39;,
 &#39;radius error&#39;,
 &#39;texture error&#39;,
 &#39;perimeter error&#39;,
 &#39;area error&#39;,
 &#39;smoothness error&#39;,
 &#39;compactness error&#39;,
 &#39;concavity error&#39;,
 &#39;concave points error&#39;,
 &#39;symmetry error&#39;,
 &#39;fractal dimension error&#39;,
 &#39;worst radius&#39;,
 &#39;worst texture&#39;,
 &#39;worst perimeter&#39;,
 &#39;worst area&#39;,
 &#39;worst smoothness&#39;,
 &#39;worst compactness&#39;,
 &#39;worst concavity&#39;,
 &#39;worst concave points&#39;,
 &#39;worst symmetry&#39;,
 &#39;worst fractal dimension&#39;,
 &#39;malignant&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_schema</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean radius&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean texture&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean perimeter&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean area&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean smoothness&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean compactness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span> <span class="s1">&#39;mean concavity&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean concave points&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean symmetry&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean fractal dimension&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;radius error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;texture error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;perimeter error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;area error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;smoothness error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;compactness error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;concavity error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;concave points error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;symmetry error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;fractal dimension error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst radius&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst texture&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst perimeter&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst area&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst smoothness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst compactness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst concavity&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst concave points&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst symmetry&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst fractal dimension&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;malignant&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),]</span>             
            
<span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">data_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cancer_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;breast_cancer.csv&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
<span class="n">cancer_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;mean radius&#39;,
 &#39;mean texture&#39;,
 &#39;mean perimeter&#39;,
 &#39;mean area&#39;,
 &#39;mean smoothness&#39;,
 &#39;mean compactness&#39;,
 &#39;mean concavity&#39;,
 &#39;mean concave points&#39;,
 &#39;mean symmetry&#39;,
 &#39;mean fractal dimension&#39;,
 &#39;radius error&#39;,
 &#39;texture error&#39;,
 &#39;perimeter error&#39;,
 &#39;area error&#39;,
 &#39;smoothness error&#39;,
 &#39;compactness error&#39;,
 &#39;concavity error&#39;,
 &#39;concave points error&#39;,
 &#39;symmetry error&#39;,
 &#39;fractal dimension error&#39;,
 &#39;worst radius&#39;,
 &#39;worst texture&#39;,
 &#39;worst perimeter&#39;,
 &#39;worst area&#39;,
 &#39;worst smoothness&#39;,
 &#39;worst compactness&#39;,
 &#39;worst concavity&#39;,
 &#39;worst concave points&#39;,
 &#39;worst symmetry&#39;,
 &#39;worst fractal dimension&#39;,
 &#39;malignant&#39;]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="preprocessing-dei-dati">
<h1>Preprocessing dei dati<a class="headerlink" href="#preprocessing-dei-dati" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>All’interno del parametro inputCols dobbiamo specificare quali sono le colonne con gli input.</p></li>
<li><p>All’interno del parametro outputCol dobbiamo specificare il nome della colonna che conterrà le features.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorAssembler</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">cancer_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">cancer_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;scaled_features&quot;</span><span class="p">)</span>
<span class="n">scaler_model</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Ora possiamo creare i DataFrame per addestramento e test, estraendoli dal Dataframe originale, possiamo farlo tramite il metodo RandomSplit. Assegnamo il 70% degli esempi al set di addestramento e il 30% al set di test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_set</span><span class="p">,</span> <span class="n">test_set</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> esempi nel train set&quot;</span> <span class="o">%</span> <span class="n">train_set</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> esempi nel test set&quot;</span> <span class="o">%</span> <span class="n">test_set</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>383 esempi nel train set
180 esempi nel test set
</pre></div>
</div>
</div>
</div>
<p>Ottimo ! Ora possiamo creare il modello di Regressione Logistica, usiamo la classe *LogisticRegression, all’interno del costruttore dovremo passare due parametri:</p>
<ul class="simple">
<li><p><strong>featuresCol</strong>: il nome della colonna con le features</p></li>
<li><p><strong>labelCol</strong>: il nome della colonna con il target</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s2">&quot;scaled_features&quot;</span><span class="p">,</span> <span class="n">labelCol</span><span class="o">=</span><span class="s2">&quot;malignant&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Avviamo l’addestramento con il metodo <em>fit</em>, passando al suo interno il set di addetramento</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Abbiamo creato il nostro modello ! Ora verifichiamone la qualità.</p>
</div>
<div class="section" id="valutiamo-il-modello">
<h1>Valutiamo il Modello<a class="headerlink" href="#valutiamo-il-modello" title="Permalink to this headline">¶</a></h1>
<p>Ora verifichiamone la qualità testandolo su dati che non ha visto durante l’addestramento, possiamo farlo usando il test set e il metodo <em>evalualte</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Il metodo <em>evaluate</em> calcolerà diverse metriche che ci possono aiutare a comprendere la qualità del modello, vediamone alcune.</p>
<div class="section" id="accuracy-accuratezza">
<h2>Accuracy (Accuratezza)<a class="headerlink" href="#accuracy-accuratezza" title="Permalink to this headline">¶</a></h2>
<p>L’accuracy indica semplicemente la percentuale di classificazioni che il nostro modello ha eseguito correttamente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span><span class="o">.</span><span class="n">accuracy</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.9444444444444444
</pre></div>
</div>
</div>
</div>
<p>### Precision (Precision)
La precision ci dice, tra le classificazioni eseguite per una data classe, quante sono effettivamente apparteneti a quella classe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span><span class="o">.</span><span class="n">precisionByLabel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[0.9180327868852459, 0.957983193277311]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recall-richiamo">
<h2>Recall (Richiamo)<a class="headerlink" href="#recall-richiamo" title="Permalink to this headline">¶</a></h2>
<p>Il recall ci dice quanti dei casi positivi il modello è riuscito a classificare correttamente.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evaluation</span><span class="o">.</span><span class="n">recallByLabel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[0.9180327868852459, 0.957983193277311]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="testiamo-il-modello">
<h1>Testiamo il modello<a class="headerlink" href="#testiamo-il-modello" title="Permalink to this headline">¶</a></h1>
<p>Ora che abbiamo addestrato e validato il nostro modello, testiamolo su nuovi dati. Una clinica ci invia un file CSV contenente i risultati dell’agobiopsia per 3 pazienti che hanno in cura, dobbiamo utilizzare il nostro modello per identificare eventuali tumori maligni. Scarichiamo  il CSV</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget https://frenzy86.s3.eu-west-2.amazonaws.com/fav/tecno/exam_results.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>--2020-06-22 21:51:31--  https://frenzy86.s3.eu-west-2.amazonaws.com/fav/tecno/exam_results.csv
Resolving frenzy86.s3.eu-west-2.amazonaws.com (frenzy86.s3.eu-west-2.amazonaws.com)... 52.95.148.94
Connecting to frenzy86.s3.eu-west-2.amazonaws.com (frenzy86.s3.eu-west-2.amazonaws.com)|52.95.148.94|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1143 (1.1K) [application/vnd.ms-excel]
Saving to: ‘exam_results.csv.1’

exam_results.csv.1  100%[===================&gt;]   1.12K  --.-KB/s    in 0s      

2020-06-22 21:51:32 (28.2 MB/s) - ‘exam_results.csv.1’ saved [1143/1143]

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exams_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;exam_results.csv&quot;</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Creiamo la colonna con le features</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exams_df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>root
 |-- id: integer (nullable = true)
 |-- mean radius: string (nullable = true)
 |-- mean texture: double (nullable = true)
 |-- mean perimeter: double (nullable = true)
 |-- mean area: double (nullable = true)
 |-- mean smoothness: double (nullable = true)
 |-- mean compactness: double (nullable = true)
 |-- mean concavity: double (nullable = true)
 |-- mean concave points: double (nullable = true)
 |-- mean symmetry: double (nullable = true)
 |-- mean fractal dimension: double (nullable = true)
 |-- radius error: double (nullable = true)
 |-- texture error: double (nullable = true)
 |-- perimeter error: double (nullable = true)
 |-- area error: double (nullable = true)
 |-- smoothness error: double (nullable = true)
 |-- compactness error: double (nullable = true)
 |-- concavity error: double (nullable = true)
 |-- concave points error: double (nullable = true)
 |-- symmetry error: double (nullable = true)
 |-- fractal dimension error: double (nullable = true)
 |-- worst radius: double (nullable = true)
 |-- worst texture: double (nullable = true)
 |-- worst perimeter: double (nullable = true)
 |-- worst area: double (nullable = true)
 |-- worst smoothness: double (nullable = true)
 |-- worst compactness: double (nullable = true)
 |-- worst concavity: double (nullable = true)
 |-- worst concave points: double (nullable = true)
 |-- worst symmetry: double (nullable = true)
 |-- worst fractal dimension: double (nullable = true)

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_schema</span> <span class="o">=</span> <span class="p">[</span><span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean radius&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean texture&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean perimeter&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean area&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean smoothness&#39;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean compactness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span> <span class="s1">&#39;mean concavity&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean concave points&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean symmetry&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;mean fractal dimension&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;radius error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;texture error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;perimeter error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;area error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;smoothness error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;compactness error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;concavity error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;concave points error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;symmetry error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;fractal dimension error&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst radius&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst texture&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst perimeter&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst area&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst smoothness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst compactness&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst concavity&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst concave points&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst symmetry&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
                <span class="n">StructField</span><span class="p">(</span><span class="s1">&#39;worst fractal dimension&#39;</span><span class="p">,</span><span class="n">FloatType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)]</span>             
            
<span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="n">data_schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exams_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;exam_results.csv&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">exams_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>+------+-----------+------------+--------------+---------+---------------+----------------+--------------+-------------------+-------------+----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+
|    id|mean radius|mean texture|mean perimeter|mean area|mean smoothness|mean compactness|mean concavity|mean concave points|mean symmetry|mean fractal dimension|radius error|texture error|perimeter error|area error|smoothness error|compactness error|concavity error|concave points error|symmetry error|fractal dimension error|worst radius|worst texture|worst perimeter|worst area|worst smoothness|worst compactness|worst concavity|worst concave points|worst symmetry|worst fractal dimension|
+------+-----------+------------+--------------+---------+---------------+----------------+--------------+-------------------+-------------+----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+
|150010|       13.3|       21.57|         85.24|    546.1|        0.08582|         0.06373|       0.03344|            0.02424|       0.1815|               0.05696|      0.2621|        1.539|          2.028|     20.98|        0.005498|          0.02045|        0.01795|            0.006399|       0.01829|               0.001956|        14.2|         29.2|          92.94|     621.2|           0.114|           0.1667|         0.1212|             0.05614|        0.2637|                0.06658|
|150011|      10.48|       14.98|         67.49|    333.6|        0.09816|          0.1013|       0.06335|            0.02218|       0.1925|               0.06915|      0.3276|        1.127|          2.564|     20.77|        0.007364|          0.03867|        0.05263|             0.01264|       0.02161|                0.00483|       12.13|        21.57|          81.41|     440.4|          0.1327|           0.2996|         0.2939|              0.0931|         0.302|                0.09646|
|  null|       null|        null|          null|     null|           null|            null|          null|               null|         null|                  null|        null|         null|           null|      null|            null|             null|           null|                null|          null|                   null|        null|         null|           null|      null|            null|             null|           null|                null|          null|                   null|
+------+-----------+------------+--------------+---------+---------------+----------------+--------------+-------------------+-------------+----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+------------+-------------+---------------+----------+----------------+-----------------+---------------+--------------------+--------------+-----------------------+

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_data_df</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">exams_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Eseguiamo la standardizzazione</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_data_df</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">new_data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>E otteniamo le predizioni usando il metodo <em>transform</em> del modello</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">new_data_df</span><span class="p">)</span>
<span class="n">pred_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;id&#39;,
 &#39;mean radius&#39;,
 &#39;mean texture&#39;,
 &#39;mean perimeter&#39;,
 &#39;mean area&#39;,
 &#39;mean smoothness&#39;,
 &#39;mean compactness&#39;,
 &#39;mean concavity&#39;,
 &#39;mean concave points&#39;,
 &#39;mean symmetry&#39;,
 &#39;mean fractal dimension&#39;,
 &#39;radius error&#39;,
 &#39;texture error&#39;,
 &#39;perimeter error&#39;,
 &#39;area error&#39;,
 &#39;smoothness error&#39;,
 &#39;compactness error&#39;,
 &#39;concavity error&#39;,
 &#39;concave points error&#39;,
 &#39;symmetry error&#39;,
 &#39;fractal dimension error&#39;,
 &#39;worst radius&#39;,
 &#39;worst texture&#39;,
 &#39;worst perimeter&#39;,
 &#39;worst area&#39;,
 &#39;worst smoothness&#39;,
 &#39;worst compactness&#39;,
 &#39;worst concavity&#39;,
 &#39;worst concave points&#39;,
 &#39;worst symmetry&#39;,
 &#39;worst fractal dimension&#39;,
 &#39;features&#39;,
 &#39;scaled_features&#39;,
 &#39;rawPrediction&#39;,
 &#39;probability&#39;,
 &#39;prediction&#39;]
</pre></div>
</div>
</div>
</div>
<p>Come vedi il DataFrame risultante contiene due nuove colonne:</p>
<ul class="simple">
<li><p><strong>Prediction</strong>: che contiene il label (0=benigno, 1=maligno)</p></li>
<li><p><strong>Probabily</strong>: che contiene la probabilità di apparteneza alle due classi.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pred_df.select([&quot;probability&quot;, &quot;prediction&quot;]).show(6, False)</span>
<span class="n">pred_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Due dei tumori sono stati etichettati come maligni, con delle probabilità associate molto alte, sarebbe il caso che la clinica effettuasse ulteriori esami.</p>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Manuel Rucci / Daniele Grotti<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>